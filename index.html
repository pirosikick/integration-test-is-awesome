<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="FukuokaJS第14回の登壇資料です。Testing TrophyのIntegration Testがいいぞという話です。"><title>Integration Test、いいぞ</title><meta property="og:title" content="Integration Test、いいぞ"><meta property="og:type" content="article"><meta property="og:url" content="https://pirosikick.github.io/integration-test-is-awesome/"><meta property="og:image" content="https://pirosikick.github.io/integration-test-is-awesome/thumbnail.png"><meta property="og:description" content="FukuokaJS第14回の登壇資料です。Testing TrophyのIntegration Testがいいぞという話です。"><script defer="defer" src="/integration-test-is-awesome/runtime.b1a4d4650f5bea03c974.bundle.js"></script><script defer="defer" src="/integration-test-is-awesome/vendor.fa698509ee4d14fd4128.bundle.js"></script><script defer="defer" src="/integration-test-is-awesome/main.3fb2d96e3942e3f3497d.bundle.js"></script><link href="/integration-test-is-awesome/vendor.fa698509ee4d14fd4128.css" rel="stylesheet"><link href="/integration-test-is-awesome/main.3fb2d96e3942e3f3497d.css" rel="stylesheet"><link rel="prefetch" as="script" href="/integration-test-is-awesome/901.7a459a33af8efbff0f76.bundle.js"><link rel="prefetch" as="script" href="/integration-test-is-awesome/921.a4a742dc62a63a6dcf98.bundle.js"></head><body><div id="root"><div class="swiper-container swiper-container-initialized swiper-container-horizontal swiper-container-pointer-events" id="main-slides"><div class="swiper-pagination"></div><div class="swiper-wrapper" id="swiper-wrapper-97618df9bc0b8fc5" aria-live="polite" style="transform: translate3d(0px, 0px, 0px);"><div class="swiper-slide swiper-slide-active" data-hash="slide-1" role="group" aria-label="1 / 24" style="width: 1184px;"><div class="slide-internal-box"><h1>Integration Test、いいぞ</h1><p><a href="https://fukuokajs.connpass.com/event/225489/">#14 【オンライン開催】FukuokaJS - connpass</a></p></div></div><div class="swiper-slide swiper-slide-next" data-hash="slide-2" role="group" aria-label="2 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>自己紹介</h2><ul><li><a href="https://twitter.com/pirosikick">@pirosikick</a></li><li>株式会社 Zene CTO</li><li>エンジニア募集中！<ul><li><a href="https://www.wantedly.com/companies/company_6418169/projects">https://www.wantedly.com/companies/company_6418169/projects</a></li></ul></li></ul></div></div><div class="swiper-slide" data-hash="slide-3" role="group" aria-label="3 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>今日の話</h2><ul><li>Testing Trophy の Integration Test、いいぞ！という話</li><li>そんなこと言わなくてもみんなそう思っている場合は、休憩時間としてお使いください</li></ul></div></div><div class="swiper-slide" data-hash="slide-4" role="group" aria-label="4 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>Integration Test とは？</h2><ul><li>広義では「結合テスト」</li><li>狭義（というか今日の発表のスコープ）では、Testing Trophy の Integration Test<ul><li><a href="https://testingjavascript.com/">Testing JavaScript with Kent C. Dodds https://testingjavascript.com/</a></li><li>2018 年頃に Kent C. Dodds が提唱した概念。割と浸透している？</li><li>テストピラミッドとは違って、<br>Unit test より Static test・Integration test のボリュームを増やそうという図</li></ul></li><li>E2E と違って、API などはモックしてテストする</li><li>自分は Jest + jsdom + @testing-library/react でよく書きます</li></ul></div></div><div class="swiper-slide" data-hash="slide-5" role="group" aria-label="5 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>例: Jest + jsdom + @testing-library/react</h3><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token comment">/**
 * @jest-environment jsdom
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> screen<span class="token punctuation">,</span> waitFor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"@testing-library/jest-dom"</span><span class="token punctuation">;</span>

<span class="token comment">// アプリケーションのルートコンポーネント</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HogeApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./HogeApp"</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// jsdomに描画</span>
  screen<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>HogeApp <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 何か待つ時に使う（後述）</span>
  <span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"…"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 要素の取得</span>
  <span class="token keyword">const</span> submitButton <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"送信する"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 描画された内容を検証する（後述）</span>
  …
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-6" role="group" aria-label="6 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>要素の取得（get/query/find, getAll/queryAll/findAll）</h3><ul><li><a href="https://testing-library.com/docs/react-testing-library/cheatsheet">https://testing-library.com/docs/react-testing-library/cheatsheet</a></li></ul><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token comment">/* 要素がなかった時にエラーを返す or null */</span>
<span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throw an error</span>
<span class="token function">queryByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span>

<span class="token comment">/* 要素が複数ある時にエラーを返す or 全部取得 */</span>
<span class="token comment">// throw an error</span>
<span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throw an error</span>
<span class="token function">queryByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throw an error</span>
<span class="token comment">// マッチする要素をすべて返す</span>
<span class="token function">getAllByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">queryAllByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 同期 */</span>
<span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">queryByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 非同期(要素が現れるまで待つ) */</span>
<span class="token keyword">await</span> <span class="token function">findByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-7" role="group" aria-label="7 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>要素の取得（By*）</h3><ul><li><a href="https://testing-library.com/docs/react-testing-library/cheatsheet">https://testing-library.com/docs/react-testing-library/cheatsheet</a></li><li>何を元に要素を探すか<ul><li>ByLabelText, ByPlaceholderText, ByText,<br>ByDisplayValue, ByAltText, ByTitle, ByRole, ByTestId</li></ul></li></ul><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token comment">// "送信する"ボタンを取得</span>
<span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"送信する"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-8" role="group" aria-label="8 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>描画された内容を検証する</h3><p>便利な Jest のカスタムマッチャーを提供している<a href="https://github.com/testing-library/jest-dom">@testing-library/jest-dom</a>は必須。</p><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token keyword">import</span> <span class="token string">"@testing-library/jest-dom"</span><span class="token punctuation">;</span>

<span class="token comment">// 表示・非表示</span>
<span class="token function">expect</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 活性・非活性</span>
<span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 他にも色々あるよ</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-9" role="group" aria-label="9 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>API のモック</h3><p>@testinng-library/react の<a href="https://testing-library.com/docs/react-testing-library/example-intro">Example</a>で紹介されているのは、<a href="https://www.npmjs.com/package/msw">msw</a>。</p><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> rest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"msw"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setupServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"msw/node"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">setupServer</span><span class="token punctuation">(</span>
  rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/greeting"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> greeting<span class="token operator">:</span> <span class="token string">"hello there"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> server<span class="token punctuation">.</span><span class="token function">resetHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-10" role="group" aria-label="10 / 24" style="width: 1184px;"><div class="slide-internal-box"><p>自分の場合は、API 呼び出し等を関数化して、その関数をモックするのが好み。</p><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchSomeData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./fetchSomeData"</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./fetchSomeData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fetchSomeDataMock <span class="token operator">=</span> fetchSomeData <span class="token keyword">as</span> jest<span class="token punctuation">.</span>Mock<span class="token punctuation">;</span>
<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fetchSomeDataMock<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fetchSomeDataMock<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> … <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  screen<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>HogeApp <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>fetchSomeDataMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"calls fetchSomeData correctly"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回数</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fetchSomeDataMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 引数</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fetchSomeDataMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>…<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-11" role="group" aria-label="11 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>Integration Test のいいところ</h2><ol><li>セットアップが楽</li><li>リファクタが捗る</li><li>安定したテストが書ける</li><li>a11y についてちょっと考える機会が発生する</li></ol><p>ほとんど、@testing-library/*がよくできているぞという話な気がするが。</p></div></div><div class="swiper-slide" data-hash="slide-12" role="group" aria-label="12 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>1. セットアップが楽</h3><p>jest, @testing-library/react, @testing-library/jest-dom をインストールするだけ。</p><pre class=" language-console" tabindex="0"><code class=" language-console">$ npm install -D \
    jest \
    @testing-library/react \
    @testing-library/jest-dom
</code></pre><p>CI 上でも問題なく動く</p></div></div><div class="swiper-slide" data-hash="slide-13" role="group" aria-label="13 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>2. リファクタが捗る</h3><ul><li>一般的には E2E より実行時間が短いので、<br>
レッド・グリーン・リファクタリングが回しやすい</li><li>@testing-library/*がよくできており、<br>
テストが実装依存になりにくく、リファクタでテストが壊れることが少ない</li></ul></div></div><div class="swiper-slide" data-hash="slide-14" role="group" aria-label="14 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>3. 安定したテストが書ける</h3></div></div><div class="swiper-slide" data-hash="slide-15" role="group" aria-label="15 / 24" style="width: 1184px;"><div class="slide-internal-box"><h4>3.1 <code>waitFor</code>で待つ</h4><pre class=" language-ts" tabindex="0"><code class=" language-ts"><span class="token comment">// モックが呼ばれるのを待つ</span>
<span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 要素が出現するのを待つ</span>
<span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 要素が出現するのを待つ その2</span>
<span class="token keyword">await</span> screen<span class="token punctuation">.</span><span class="token function">findByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"…"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-16" role="group" aria-label="16 / 24" style="width: 1184px;"><div class="slide-internal-box"><h4>3.2 DOM 上の構造を変更しても大丈夫</h4><ul><li>getByRole や getByText など、DOM の構造に依存しないテストが書けるので、<br>
リファクタでコンポーネントを弄りまくってもテストが壊れにくい</li></ul></div></div><div class="swiper-slide" data-hash="slide-17" role="group" aria-label="17 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>4. a11y について意識する機会がちょっと発生する</h3><ul><li>テストを安定させるには、<br>なるべく getByRole で要素を取得したいという動機が働く</li><li>そのためにはセマンティックな DOM 構造が必要</li><li>「〜は a11y 的にはどうコーディングするのがいいのかな？調べてみるか」となる</li></ul></div></div><div class="swiper-slide" data-hash="slide-18" role="group" aria-label="18 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>最近、特に「いい！」と思った瞬間</h2></div></div><div class="swiper-slide" data-hash="slide-19" role="group" aria-label="19 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>kintone のカスタマイズの Integration Test を書いた時</h3><ul><li>kintone 上に React で作った UI を埋め込む</li><li>E2E は難しい。手で確認するにもデータを用意するのがだるい</li><li>kintone の API はモックしつつ、
Integration Test で十分なケースのテストができ、<br>バグもほぼ出なかった</li><li>モックした部分には Assertion を仕込んでいたので、<br>
想定外のデータが kintone から来ている場合もすぐ気づくことができた</li><li>リリース後も安心してリファクタできた</li></ul><p>E2E 環境を作るのが難しい場合は特に有用かもしれない</p></div></div><div class="swiper-slide" data-hash="slide-20" role="group" aria-label="20 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>Integration Test でカバーできないところ</h2><ul><li>アニメーションのテスト<ul><li>Storybook 等でカバーする</li></ul></li><li>jsdom がサポートしていない機能はモックするしかない<ul><li><a href="https://github.com/jsdom/jsdom#unimplemented-parts-of-the-web-platform">https://github.com/jsdom/jsdom#unimplemented-parts-of-the-web-platform</a></li><li>Storybook 等でカバーする</li><li>E2E でカバーする</li></ul></li><li>本物の API、データベース等を使ったテスト<ul><li>E2E でカバーする</li><li>GraphQL/Open API などスキーマで担保する</li><li>Assertion を挿入する</li></ul></li></ul><p>Integration Test でカバーできないところを頭に入れて、<br>
E2E を減らすことができれば、CI の実行時間が短縮できてよさそう。</p></div></div><div class="swiper-slide" data-hash="slide-21" role="group" aria-label="21 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>まとめ</h2></div></div><div class="swiper-slide" data-hash="slide-22" role="group" aria-label="22 / 24" style="width: 1184px;"><div class="slide-internal-box"><h3>冷静に整理すると、<br>testing-library が最高という話だった。</h3><ul><li>セットアップが楽ですぐ始めることができる</li><li>安定したテストが書けるので、リファクタしやすい</li></ul></div></div><div class="swiper-slide" data-hash="slide-23" role="group" aria-label="23 / 24" style="width: 1184px;"><div class="slide-internal-box"><h2>We're hiring</h2><ul><li>株式会社 Zene<ul><li><a href="https://www.zene.co.jp/">https://www.zene.co.jp/</a></li><li>"ゲノムをより身近に、あたりまえの世界に"</li></ul></li><li><a href="https://www.wantedly.com/companies/company_6418169/projects">https://www.wantedly.com/companies/company_6418169/projects</a></li></ul></div></div><div class="swiper-slide" data-hash="slide-24" role="group" aria-label="24 / 24" style="width: 1184px;"><div class="slide-internal-box"><h1>おわり</h1><p>ありがとうございました</p></div></div></div><span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span></div></div></body></html>